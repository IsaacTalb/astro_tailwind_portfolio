---
import "../styles/global.css";
import ParticleBackground from '../components/ParticleBackground.astro';
import Head from '../components/Head.astro';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';
import { SITE } from '../config';

const { metadata, image = '', url = '' } = Astro.props;
const frontmatter = Astro.props.frontmatter || {};
const title = metadata?.TITLE || frontmatter.SEOTitle || frontmatter.title || SITE.TITLE;
const description = metadata?.DESCRIPTION || frontmatter.SEODescription || frontmatter.description || SITE.DESCRIPTION;
const resolvedImage = image || frontmatter.SEOImage || SITE.Favicon;
---

<!doctype html>
<html lang="en">
  <head>
    <Head title={`${title} | ${SITE.TITLE}`} description={description} image={resolvedImage} />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="icon" type="image/x-icon" href={SITE.Favicon}>
  </head>
  <body>
    <Navbar />
    <ParticleBackground />
    <main class="max-w-3xl mx-auto px-6 py-12">
      <slot />
    </main>
    <Footer />
  </body>
</html>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll("pre code").forEach((blockEl) => {
      const block = blockEl as HTMLElement;
      const pre = block.parentElement as HTMLElement | null;
      if (!pre) return;

      const wrapper = document.createElement("div");
      wrapper.style.position = "relative";
      wrapper.className = "group";
      pre.parentNode?.insertBefore(wrapper, pre);
      wrapper.appendChild(pre);

      const button = document.createElement("button");
      button.textContent = "Copy";
      button.className =
        "absolute top-2 right-2 bg-gray-700 text-white text-xs px-2 py-1 rounded opacity-70 group-hover:opacity-100 transition hover:bg-blue-600";
      wrapper.appendChild(button);

      button.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(block.innerText);
          button.textContent = "Copied!";
          setTimeout(() => (button.textContent = "Copy"), 2000);
        } catch (err) {
          console.error("Failed to copy: ", err);
          button.textContent = "Error";
          setTimeout(() => (button.textContent = "Copy"), 2000);
        }
      });
    });
  });
</script>


